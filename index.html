<!DOCTYPE html>
<html>
<head>
  <title>Карта объектов из CSV</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <style>
    #map { width: 100%; height: 600px; margin: 20px auto; border: 1px solid #ccc; }
    h2 { text-align: center; font-family: Arial, sans-serif; }
    .info { padding: 6px 8px; background: white; background: rgba(255,255,255,0.8); }
  </style>
</head>
<body>
  <h2>Объекты захламления на карте Sentinel-2</h2>
  <div id="map"></div>

  <script>
    // Инициализация карты с приблизительным центром
    const map = L.map('map').setView([60.5, 72.2], 10);
    
    // Добавление слоя Sentinel-2 (True Color)
    const sentinelLayer = L.tileLayer(
      'https://services.sentinel-hub.com/ogc/wms/10084d2d-cc90-4fd3-8c37-8c6f72f892b9?' +
      'SERVICE=WMS&REQUEST=GetMap&LAYERS=SWIR' +
      'BBOX=71,60,73,61&WIDTH=1200&HEIGHT=800&' +
      'TIME=2024-01-01/2024-05-31&FORMAT=image/jpeg&SHOWLOGO=false',
      {
        attribution: 'Sentinel-2 © ESA/Sentinel Hub',
        maxZoom: 18
      }
    ).addTo(map);

    // Создаем слой для маркеров
    const markersLayer = L.layerGroup().addTo(map);

    // Функция для загрузки и обработки CSV
    function loadCSV() {
      // В реальном коде замените на загрузку вашего файла
      const csvData = `ID карточки,Наименование,№ в реестре,Дата обнаружения,Вид объекта,Категория земель,Муниципальное образование,Местоположение,Долгота,Широта,Тип отходов,Площадь (га),Объем (м3),Отметка о ликвидации,Дата ликвидации,Примечание,Прикреплённые файлы
657,Захламление (06.05.2024) (9-657) (через дорогу от строения № 59 п. Сентябрьский),9-657,06.05.2024,Захламление,Земли населенных пунктов,Нефтеюганский район,через дорогу от строения № 59 п. Сентябрьский,72.21289063,60.49416733,ТКО, промышленные отходы,0.005,4,нет,,,`;

      Papa.parse('МестаНРО_для ГИС Хакатона.csv', {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          results.data.forEach(row => {
            if (row.Широта && row.Долгота) {
              const lat = parseFloat(row.Широта.replace(',', '.'));
              const lng = parseFloat(row.Долгота.replace(',', '.'));
              
              // Создаем маркер
              const marker = L.marker([lat, lng]).addTo(markersLayer);
              
              // Формируем popup-контент
              let popupContent = `<b>${row.Наименование}</b><hr>`;
              popupContent += `<b>Местоположение:</b> ${row.Местоположение}<br>`;
              popupContent += `<b>Дата обнаружения:</b> ${row['Дата обнаружения']}<br>`;
              popupContent += `<b>Тип отходов:</b> ${row['Тип отходов']}<br>`;
              popupContent += `<b>Площадь:</b> ${row['Площадь (га)']} га<br>`;
              popupContent += `<b>Объем:</b> ${row['Объем (м3)']} м³`;
              
              marker.bindPopup(popupContent);
            }
          });
          
          // Автоматически подгоняем карту под все маркеры
          if (markersLayer.getLayers().length > 0) {
            map.fitBounds(markersLayer.getBounds());
          }
        }
      });
    }

    // Загружаем данные при открытии страницы
    loadCSV();
  </script>
</body>
</html>
