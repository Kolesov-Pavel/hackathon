!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.mapglGltfPlugin=e():t.mapglGltfPlugin=e()}(self,(()=>(()=>{var t={327:(t,e,o)=>{(e=o(645)(!1)).push([t.id,".mapgl_1Ipy1VJjuzGNGotMcgWmxP {\n    position: relative;\n}\n\n.mapgl_2crG0BB-wHa36Yb0Ov2sNL {\n    display: flex;\n    position: relative;\n    max-height: 148px;\n    background: #ffffff;\n    width: 55px;\n    overflow: hidden;\n    border-radius: 4px;\n    box-shadow: 0 1px 3px 0 rgba(38, 38, 38, 0.5);\n}\n\n.mapgl_37s_oKukEagej3gCZ9K5G9::before,\n.mapgl_37s_oKukEagej3gCZ9K5G9::after {\n    user-select: none;\n    display: block;\n    position: absolute;\n    content: '';\n    width: 100%;\n    height: 8px;\n    left: 0;\n    z-index: 1;\n}\n\n.mapgl_37s_oKukEagej3gCZ9K5G9::before {\n    top: 0;\n    background-image: linear-gradient(\n        to bottom,\n        rgba(255, 255, 255, 1) 25%,\n        rgba(255, 255, 255, 0)\n    );\n}\n\n.mapgl_37s_oKukEagej3gCZ9K5G9::after {\n    bottom: 0;\n    background-image: linear-gradient(to top, rgba(255, 255, 255, 1) 25%, rgba(255, 255, 255, 0));\n}\n\n.mapgl_3fvkZss3Dj-loUkOaVAZ3w {\n    margin-bottom: 8px;\n    display: block;\n}\n\n.mapgl_2bnNGLCLlVFk6MbU-gOp-x {\n    width: 100%;\n    overflow-x: hidden;\n    overflow-y: overlay;\n    -moz-padding-end: 17px;\n    -webkit-padding-end: 17px;\n    -webkit-margin-end: -17px;\n}\n\n.mapgl_3y6QqDMJLXelqKgwfyjRVh {\n    display: flex;\n    flex-direction: column-reverse;\n}\n\n.mapgl_3MI0mVyJ_IX01CKChC7Rdd {\n    display: flex;\n    flex-direction: column-reverse;\n}\n\n.mapgl_VM06PjPfLT-vXtCPi3wqO {\n    all: revert;\n    padding: 0;\n    border: none;\n    background: #ffffff;\n    padding-left: 4px;\n    padding-right: 4px;\n    height: 32px;\n    width: 55px;\n    color: #262626;\n    cursor: pointer;\n    border-bottom: 1px solid #e6e6e6;\n    box-sizing: border-box;\n    flex-shrink: 0;\n}\n\n.mapgl_VM06PjPfLT-vXtCPi3wqO img {\n    max-width: 100%;\n    max-height: 100%;\n}\n\n.mapgl_VM06PjPfLT-vXtCPi3wqO:focus {\n    outline: 0;\n}\n\n.mapgl_VM06PjPfLT-vXtCPi3wqO:first-child {\n    border-bottom: none;\n}\n\n.mapgl_VM06PjPfLT-vXtCPi3wqO:hover {\n    color: rgba(38, 38, 38, 0.7);\n}\n\n.mapgl_VM06PjPfLT-vXtCPi3wqO:hover svg,\n.mapgl_VM06PjPfLT-vXtCPi3wqO:hover img {\n    opacity: 0.7;\n}\n\n.mapgl_VM06PjPfLT-vXtCPi3wqO:active {\n    color: #028eff;\n}\n\n.mapgl_VM06PjPfLT-vXtCPi3wqO:disabled {\n    background: #f2f2f2;\n    color: #929292;\n    cursor: default;\n}\n\n.mapgl_VM06PjPfLT-vXtCPi3wqO:disabled svg,\n.mapgl_VM06PjPfLT-vXtCPi3wqO:disabled img {\n    opacity: 0.7;\n}\n\n.mapgl_37fuQ7_mSuXll3aXdrTbZU {\n    font-size: 18px;\n    line-height: 32px;\n    font-weight: 400;\n    overflow-wrap: break-word;\n    overflow: hidden;\n    position: relative;\n    text-align: center;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.mapgl_3GRA2IGOdj4tXhXfeNNfK6:after {\n    content: '';\n    position: absolute;\n    top: 4px;\n    bottom: 4px;\n    width: 4px;\n    height: 4px;\n    border-radius: 50%;\n    background: #028eff;\n}\n",""]),e.locals={root:"mapgl_1Ipy1VJjuzGNGotMcgWmxP",container:"mapgl_2crG0BB-wHa36Yb0Ov2sNL",containerFloors:"mapgl_37s_oKukEagej3gCZ9K5G9",splitContainer:"mapgl_3fvkZss3Dj-loUkOaVAZ3w",scroller:"mapgl_2bnNGLCLlVFk6MbU-gOp-x",content:"mapgl_3y6QqDMJLXelqKgwfyjRVh",contentHome:"mapgl_3MI0mVyJ_IX01CKChC7Rdd",control:"mapgl_VM06PjPfLT-vXtCPi3wqO",label:"mapgl_37fuQ7_mSuXll3aXdrTbZU",_hasResult:"mapgl_3GRA2IGOdj4tXhXfeNNfK6"},t.exports=e},418:(t,e,o)=>{(e=o(645)(!1)).push([t.id,".mapgl_1Vyw88Ea45Wl91OR1UyQwx {\n    font-family: sans-serif;\n    position: relative;\n    background: white;\n    padding: 4px 24px;\n    border-radius: 12px;\n    box-shadow: rgba(0, 0, 0, 0.3) 0 2px 10px;\n    max-width: 300px;\n}\n\n.mapgl_1Vyw88Ea45Wl91OR1UyQwx h2 {\n    font-size: 18px;\n    padding-right: 16px;\n    margin-bottom: 0;\n    letter-spacing: -0.5px;\n}\n\n.mapgl_1Vyw88Ea45Wl91OR1UyQwx p {\n    font-size: 12px;\n    line-height: 18px;\n    margin-top: 16px;\n}\n",""]),e.locals={popup:"mapgl_1Vyw88Ea45Wl91OR1UyQwx"},t.exports=e},645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var o=function(t,e){var o,n,i,s=t[1]||"",r=t[3];if(!r)return s;if(e&&"function"==typeof btoa){var l=(o=r,n=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),"/*# ".concat(i," */")),d=r.sources.map((function(t){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(t," */")}));return[s].concat(d).concat([l]).join("\n")}return[s].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(o,"}"):o})).join("")},e.i=function(t,o,n){"string"==typeof t&&(t=[[null,t,""]]);var i={};if(n)for(var s=0;s<this.length;s++){var r=this[s][0];null!=r&&(i[r]=!0)}for(var l=0;l<t.length;l++){var d=[].concat(t[l]);n&&i[d[0]]||(o&&(d[2]?d[2]="".concat(o," and ").concat(d[2]):d[2]=o),e.push(d))}},e}},299:(t,e,o)=>{var n=o(379),i=o(327);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[t.id,i,""]]);n(i,{insert:"head",singleton:!1}),t.exports=i.locals||{}},757:(t,e,o)=>{var n=o(379),i=o(418);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[t.id,i,""]]);n(i,{insert:"head",singleton:!1}),t.exports=i.locals||{}},379:(t,e,o)=>{"use strict";var n,i=function(){var t={};return function(e){if(void 0===t[e]){var o=document.querySelector(e);if(window.HTMLIFrameElement&&o instanceof window.HTMLIFrameElement)try{o=o.contentDocument.head}catch(t){o=null}t[e]=o}return t[e]}}(),s=[];function r(t){for(var e=-1,o=0;o<s.length;o++)if(s[o].identifier===t){e=o;break}return e}function l(t,e){for(var o={},n=[],i=0;i<t.length;i++){var l=t[i],d=e.base?l[0]+e.base:l[0],a=o[d]||0,c="".concat(d," ").concat(a);o[d]=a+1;var u=r(c),h={css:l[1],media:l[2],sourceMap:l[3]};-1!==u?(s[u].references++,s[u].updater(h)):s.push({identifier:c,updater:f(h,e),references:1}),n.push(c)}return n}function d(t){var e=document.createElement("style"),n=t.attributes||{};if(void 0===n.nonce){var s=o.nc;s&&(n.nonce=s)}if(Object.keys(n).forEach((function(t){e.setAttribute(t,n[t])})),"function"==typeof t.insert)t.insert(e);else{var r=i(t.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(e)}return e}var a,c=(a=[],function(t,e){return a[t]=e,a.filter(Boolean).join("\n")});function u(t,e,o,n){var i=o?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(t.styleSheet)t.styleSheet.cssText=c(e,i);else{var s=document.createTextNode(i),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(s,r[e]):t.appendChild(s)}}function h(t,e,o){var n=o.css,i=o.media,s=o.sourceMap;if(i?t.setAttribute("media",i):t.removeAttribute("media"),s&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var p=null,g=0;function f(t,e){var o,n,i;if(e.singleton){var s=g++;o=p||(p=d(e)),n=u.bind(null,o,s,!1),i=u.bind(null,o,s,!0)}else o=d(e),n=h.bind(null,o,e),i=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(o)};return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else i()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=(void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n));var o=l(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var n=0;n<o.length;n++){var i=r(o[n]);s[i].references--}for(var d=l(t,e),a=0;a<o.length;a++){var c=r(o[a]);0===s[c].references&&(s[c].updater(),s.splice(c,1))}o=d}}}}},e={};function o(n){var i=e[n];if(void 0!==i)return i.exports;var s=e[n]={id:n,exports:{}};return t[n](s,s.exports,o),s.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.nc=void 0;var n={};return(()=>{"use strict";o.r(n),o.d(n,{GltfPlugin:()=>L,ModelStatus:()=>b});class t{constructor(){this.events={}}on(t,e){let o=this.events[t];return o||(o=this.events[t]=[]),o.push(e),this}once(t,e){const o=n=>{this.off(t,o),e.call(this,n)};return this.on(t,o),this}off(t,e){const o=this.events[t];if(!o)return this;const n=o.indexOf(e);return-1!==n&&o.splice(n,1),this}emit(t,e){const o=this.events[t];if(!o)return this;const n=o.slice();for(let t=0;t<n.length;t++)n[t].call(this,e);return this}}const e="__mapglPlugins_mapgl-gltf2",i={type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[-180,-85],[180,-85],[180,85],[-180,85],[-180,-85]]]}},s=`${e}-covering`,r=`${e}-covering`,l={id:r,type:"polygon",style:{color:["to-color",["sourceAttr","color"]]},filter:["all",["match",["sourceAttr","purpose"],[s],!0,!1],["to-boolean",["sourceAttr","color"]]]},d=["click","mousemove","mouseover","mouseout"],a="#000000",c={url:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAyOCAyOCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHJ4PSI0IiBmaWxsPSIjZWFlYWVhIi8+PHJlY3QgeD0iMSIgeT0iMSIgd2lkdGg9IjI2IiBoZWlnaHQ9IjI2IiByeD0iMyIgZmlsbD0id2hpdGUiLz48L3N2Zz4=",size:[38,38],stretchX:[[4,24]],stretchY:[[4,24]],padding:[5,10,5,10]};class u{constructor(t,e,o){this.map=t,this.plugin=e,this.options=o,this.labelsByGroupId=new Map}add(t,e){const{id:o}=t;if(this.labelsByGroupId.has(o))return void console.error(`Poi group with id "${o}" already exists. Please use different identifiers for poi groups`);const{image:n,minZoom:i,maxZoom:s,fontColor:r,fontSize:l,elevation:u,interactive:h}=t,{labelGroupDefaults:p,zIndex:g}=this.options,f=t.labels.map((t=>{var o,f,m,v;const{coordinates:b,text:y,userData:I,elevation:w,interactive:M}=t,x=new mapgl.Label(this.map,{coordinates:[...b,null!=w?w:u],text:y,userData:I,image:"default"===n?null!==(o=p.image)&&void 0!==o?o:c:n,minZoom:null!=i?i:this.options.minZoom,maxZoom:null!=s?s:this.options.maxZoom,color:null!==(f=null!=r?r:p.fontColor)&&void 0!==f?f:a,fontSize:null!==(m=null!=l?l:p.fontSize)&&void 0!==m?m:14,relativeAnchor:[.5,1],zIndex:g+1e-5,interactive:null!==(v=null!=M?M:h)&&void 0!==v&&v,labeling:{type:"pointLabelsOnly"}});return d.forEach((o=>{x.on(o,(n=>{this.plugin.emit(o,((t,e,o)=>{const n={type:"label",data:e};return void 0!==(null==o?void 0:o.buildingId)&&(n.buildingId=o.buildingId),void 0!==(null==o?void 0:o.floorId)&&(n.floorId=o.floorId),{originalEvent:t.originalEvent,point:t.point,lngLat:t.lngLat,target:n}})(n,t,e))}))})),x}));this.labelsByGroupId.set(o,f)}remove(t){const e=this.labelsByGroupId.get(t);this.labelsByGroupId.delete(t),null==e||e.forEach((t=>t.destroy()))}destroy(){this.labelsByGroupId.forEach((t=>{t.forEach((t=>t.destroy()))})),this.labelsByGroupId.clear()}}const h={hoverOptions:{color:"#ffffff"},modelsBaseUrl:"",modelsLoadStrategy:"waitAll",modelsNearCameraFade:2500,modelsColorTextureUvIndex:0,labelGroupDefaults:{fontSize:14,fontColor:a,image:c},floorsControl:{position:"centerLeft"},groundCoveringColor:"#F8F8EBCC",zIndex:0,minZoom:-1/0,maxZoom:1/0};var p=o(299),g=o.n(p);class f extends t{constructor(t,e,o){var n;super();const{position:i}=o;this._wrap=document.createElement("div"),this._wrap.style.userSelect="none",this._wrap.innerHTML=e,this._position=i,this._controlPane=t._controlPane,this._container=this._controlPane.getContainerByPosition(i),null===(n=this._container)||void 0===n||n.append(this._wrap)}destroy(){this._wrap.remove()}getPosition(){return this._position}setPosition(t){this._container.removeChild(this._wrap),this._container=this._controlPane.getContainerByPosition(t),this._container.append(this._wrap),this._position=t}getContainer(){return this._wrap}}const m=`\n    <div class="${g().root}">\n        <div class="${g().container} ${g().splitContainer}">\n            <div class="${g().contentHome}" />\n        </div>\n    </div>\n    <div class="${g().root}">\n        <div class="${g().container} ${g().containerFloors}">\n            <div class="${g().scroller}">\n                <div class="${g().content}" />\n            </div>\n        </div>\n    </div>\n`;class v extends f{constructor(t,e){super(t,m,e),this._controlHandler=t=>()=>{this._switchCurrentFloorLevel(t),this.emit("floorchange",{modelId:t})},this._root=this._wrap.querySelector(`.${g().root}`),this._content=this._wrap.querySelector(`.${g().content}`),this._contentHome=this._wrap.querySelector(`.${g().contentHome}`),this._handlers=new WeakMap,this._root.style.display="none"}show(t){var e;this._removeButtonsEventListeners();const{buildingModelId:o,activeModelId:n,floorLevels:i=[]}=t;let s;if(this._currentFloorId=n,this._root.style.display="block",this._content.innerHTML="",this._contentHome.innerHTML="",i.forEach((({modelId:t,text:e,icon:n})=>{const i=t===o?this._contentHome:this._content,r=document.createElement("button");let l=e;n&&(l=`<img src = "${n}">`,"parking"===n&&(l='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M12 0C14.209 0 16 1.791 16 4V12C16 14.209 14.209 16 12 16H4C1.791 16 0 14.209 0 12V4C0 1.791 1.791 0 4 0H12ZM9 4H5V12H7V10H9C10.654 10 12 8.654 12 7C12 5.346 10.654 4 9 4ZM9 6C9.552 6 10 6.448 10 7C10 7.552 9.552 8 9 8H7V6H9Z" fill="#262626"/>\n</svg>\n\n'),"building"===n&&(l='<svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M0 2L5.5 0L11 2V16H7V13H4V16H0V2ZM2 9H4V11H2V9ZM4 5H2V7H4V5ZM7 9H9V11H7V9ZM9 5H7V7H9V5Z" fill="#262626"/>\n<path d="M12 16H18V8L12 5.5V16Z" fill="#262626"/>\n</svg>\n')),r.className=g().control,r.innerHTML=`<div class="${g().label}">${l}</div>`,r.name=t,this._currentFloorId===t&&(r.disabled=!0,s=r);const d=this._controlHandler(t);r.addEventListener("click",d),this._handlers.set(r,d),i.append(r)})),s&&s.offsetTop){const t=null===(e=s.parentElement)||void 0===e?void 0:e.parentElement;t&&(t.scrollTop=s.offsetTop)}}hide(){this._removeButtonsEventListeners(),this._currentFloorId=void 0,this._root.style.display="none"}destroy(){this._removeButtonsEventListeners(),super.destroy()}_removeButtonsEventListeners(){this._content&&this._content.childNodes.forEach((t=>{if(this._handlers.has(t)){const e=this._handlers.get(t);void 0!==e&&t.removeEventListener("click",e)}}))}_switchCurrentFloorLevel(t){if(void 0===this._currentFloorId)return;const e=this._wrap.querySelector(`.${g().control}[name="${this._currentFloorId}"]`);e&&(e.disabled=!1);const o=this._wrap.querySelector(`.${g().control}[name="${t}"]`);o&&(o.disabled=!0),this._currentFloorId=t}}var b,y=o(757),I=o.n(y);function w(t){return{modelId:t.modelId,coordinates:t.coordinates,modelUrl:t.modelUrl,rotateX:t.rotateX,rotateY:t.rotateY,rotateZ:t.rotateZ,offsetX:t.offsetX,offsetY:t.offsetY,offsetZ:t.offsetZ,scale:t.scale,linkedIds:t.linkedIds,interactive:t.interactive,minZoom:t.minZoom,maxZoom:t.maxZoom}}function M({buildingOptions:t,id:e,modelUrl:o}){return{modelId:x(t.modelId,e),coordinates:t.coordinates,modelUrl:o,rotateX:t.rotateX,rotateY:t.rotateY,rotateZ:t.rotateZ,offsetX:t.offsetX,offsetY:t.offsetY,offsetZ:t.offsetZ,scale:t.scale,linkedIds:t.linkedIds,interactive:t.interactive,minZoom:t.minZoom,maxZoom:t.maxZoom}}function x(t,e){return`${t}_${e}`}!function(t){t[t.NoModel=0]="NoModel",t[t.Loading=1]="Loading",t[t.Loaded=2]="Loaded"}(b||(b={}));class _{constructor(t,e,o){this.plugin=t,this.map=e,this.options=o,this.buildings=new Map,this.floors=new Map,this.undergroundFloors=new Set,this.state={activeModelId:void 0,buildingVisibility:new Map,status:"visible"},this.onStyleLoad=()=>{this.map.addLayer(l)},this.onSceneMouseOut=t=>{var e;"model"===t.target.type&&(null===(e=this.popup)||void 0===e||e.destroy())},this.onSceneMouseOver=({target:t})=>{if("label"===t.type||void 0===t.modelId)return;const e=this.buildings.get(t.modelId);e&&e.popupOptions&&(this.popup=new mapgl.HtmlMarker(this.map,{coordinates:e.popupOptions.coordinates,html:C(e.popupOptions),interactive:!1}))},this.onSceneClick=({target:t})=>{if("model"===t.type)this.buildings.get(t.modelId)&&this.buildingClickHandler(t.modelId);else if("label"===t.type){const o=t.data.userData;if("object"==typeof(e=o)&&null!==e&&!Array.isArray(e)&&"string"==typeof o.url){const t=document.createElement("a");t.setAttribute("href",o.url),t.setAttribute("target","_blank"),t.click()}}var e},this.floorChangeHandler=t=>{const e=new Map;if(this.buildings.forEach(((t,o)=>{e.set(o,w(t))})),this.buildings.get(t.modelId))return void this.setState({activeModelId:t.modelId,buildingVisibility:e,status:this.state.status});const o=this.floors.get(t.modelId);return o?(this.undergroundFloors.has(t.modelId)&&e.clear(),e.set(o.buildingOptions.modelId,M(o)),void this.setState({activeModelId:t.modelId,buildingVisibility:e,status:this.state.status})):void 0},this.buildingClickHandler=t=>{var e;const o=this.buildings.get(t);if(!o)return;let n=t;const i=new Map;this.buildings.forEach(((t,e)=>{i.set(e,w(t))}));const s=null!==(e=o.floors)&&void 0!==e?e:[];if(s.length){const{modelId:t}=s[s.length-1],e=this.floors.get(t);e&&(n=t,this.undergroundFloors.has(t)&&i.clear(),i.set(e.buildingOptions.modelId,M(e)))}this.setState({buildingVisibility:i,activeModelId:n,status:this.state.status})};const{position:n}=this.options.floorsControl;this.control=new v(this.map,{position:n}),this.groundCoveringSource=new mapgl.GeoJsonSource(e,{maxZoom:2,data:i,attributes:{purpose:s}}),this.map.addLayer(l),e.on("styleload",this.onStyleLoad)}getBuildingModelId(t){if(void 0!==t){if(this.buildings.has(t))return t;{const e=this.floors.get(t);if(e)return e.buildingOptions.modelId}}}setState(t){if("destroyed"===this.state.status)return;if("destroyed"===t.status)return void(this.state=t);const e=this.state,o=new Map;this.buildings.forEach(((n,i)=>{var s,r,l,d;const a=e.buildingVisibility.get(i),c=t.buildingVisibility.get(i);if((null==a?void 0:a.modelId)!==(null==c?void 0:c.modelId)||e.status!==t.status){if(a)if(!c&&void 0!==t.activeModelId&&this.undergroundFloors.has(t.activeModelId)&&this.plugin.getModelStatus(t.activeModelId)!==b.Loaded)o.set(i,a);else if(!c||this.plugin.getModelStatus(c.modelId)===b.Loaded){this.plugin.hideModel(a.modelId),o.set(i,void 0),this.undergroundFloors.has(a.modelId)&&this.switchOffGroundCovering();const t=this.floors.get(a.modelId);t&&(null===(r=t.labelGroups)||void 0===r||r.forEach((t=>{this.plugin.removeLabelGroup(t.id)})))}if(c)if(!a&&void 0!==e.activeModelId&&this.undergroundFloors.has(e.activeModelId)&&void 0!==t.activeModelId&&this.plugin.getModelStatus(t.activeModelId)!==b.Loaded)o.set(i,a);else{const e=this.plugin.getModelStatus(c.modelId);if(e===b.Loaded){if(o.set(i,c),"visible"===t.status&&(this.plugin.showModel(c.modelId),void 0!==t.activeModelId&&t.activeModelId===c.modelId)){const t=null!==(l=this.buildings.get(c.modelId))&&void 0!==l?l:this.floors.get(c.modelId);t&&this.setMapOptions(t.mapOptions),this.undergroundFloors.has(c.modelId)&&this.switchOnGroundCovering();const e=this.floors.get(c.modelId);e&&(null===(d=e.labelGroups)||void 0===d||d.forEach((t=>{this.plugin.addLabelGroup(t,{buildingId:i,floorId:e.id})})))}}else e===b.NoModel&&this.plugin.addModel(c,!0).then((()=>{"destroyed"!==this.state.status&&this.state.activeModelId===c.modelId&&this.setState(Object.assign(Object.assign({},t),{status:this.state.status}))})),o.set(i,a)}}else if(o.set(i,a),a&&a.modelId===t.activeModelId){const t=null!==(s=this.buildings.get(a.modelId))&&void 0!==s?s:this.floors.get(a.modelId);t&&this.setMapOptions(t.mapOptions)}}));const n=this.getBuildingModelId(e.activeModelId),i=this.getBuildingModelId(t.activeModelId);if(n!==i||e.status!==t.status)if("hidden"===t.status)this.control.hide();else if(void 0!==i&&void 0!==t.activeModelId){const e=this.buildings.get(i);e&&this.control.show({buildingModelId:e.modelId,activeModelId:t.activeModelId,floorLevels:e.floors.length?[{modelId:e.modelId,icon:"building",text:""},...e.floors]:[]})}if(e.activeModelId!==t.activeModelId){let e,o;if(void 0!==t.activeModelId){const n=this.buildings.get(t.activeModelId);if(n)e=n.modelId;else{const n=this.floors.get(t.activeModelId);n&&(e=n.buildingOptions.modelId,o=n.id)}}this.plugin.emit("activemodelchange",{buildingModelId:e,floorModelId:o})}this.state={buildingVisibility:o,activeModelId:t.activeModelId,status:t.status}}init(t,e){return o=this,n=void 0,s=function*(){let o=e?e.floorId?x(e.buildingId,e.floorId):e.buildingId:void 0;t.forEach((t=>{const{floors:e}=t,o=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(o[n[i]]=t[n[i]])}return o}(t,["floors"]),n=Object.assign(Object.assign({},o),{floors:[]}),i=w(n);(null!=e?e:[]).forEach((e=>{var o;const s=x(t.modelId,e.id);n.floors.push({modelId:s,text:e.text,icon:e.icon}),this.floors.set(s,Object.assign(Object.assign({},e),{labelGroups:(null!==(o=e.labelGroups)&&void 0!==o?o:[]).map((o=>{return Object.assign(Object.assign({},o),{id:(n=t.modelId,i=e.id,s=o.id,`${n}_${i}_${s}`)});var n,i,s})),buildingOptions:i})),e.isUnderground&&this.undergroundFloors.add(s)})),this.buildings.set(t.modelId,n)})),o=void 0!==o&&(this.buildings.has(o)||this.floors.has(o))?o:void 0;const n=new Map,i=new Map;if(this.buildings.forEach(((t,e)=>{const o=w(t);n.set(e,o),i.set(e,o)})),o){const t=this.floors.get(o);if(t){this.undergroundFloors.has(o)&&i.clear();const e=M(t);i.set(t.buildingOptions.modelId,e),n.set(o,e)}}return"waitAll"===this.options.modelsLoadStrategy&&this.floors.forEach(((t,e)=>n.set(e,M(t)))),this.plugin.addModels(Array.from(n.values()),Array.from(i).map((([t,e])=>e.modelId))).then((()=>{"destroyed"!==this.state.status&&(this.setState({activeModelId:o,buildingVisibility:i,status:this.state.status}),this.plugin.on("click",this.onSceneClick),this.plugin.on("mouseover",this.onSceneMouseOver),this.plugin.on("mouseout",this.onSceneMouseOut),this.control.on("floorchange",this.floorChangeHandler))}))},new((i=void 0)||(i=Promise))((function(t,e){function r(t){try{d(s.next(t))}catch(t){e(t)}}function l(t){try{d(s.throw(t))}catch(t){e(t)}}function d(e){var o;e.done?t(e.value):(o=e.value,o instanceof i?o:new i((function(t){t(o)}))).then(r,l)}d((s=s.apply(o,n||[])).next())}));var o,n,i,s}resetGroundCoveringColor(){const t=this.groundCoveringSource.getAttributes();"color"in t&&this.groundCoveringSource.setAttributes(Object.assign(Object.assign({},t),{color:this.options.groundCoveringColor}))}show(){"hidden"===this.state.status&&this.setState(Object.assign(Object.assign({},this.state),{status:"visible"}))}hide(){"visible"===this.state.status&&this.setState(Object.assign(Object.assign({},this.state),{status:"hidden"}))}destroy(t){var e;"destroyed"!==this.state.status&&(this.setState(Object.assign(Object.assign({},this.state),{status:"destroyed"})),this.map.off("styleload",this.onStyleLoad),this.plugin.off("click",this.onSceneClick),this.plugin.off("mouseover",this.onSceneMouseOver),this.plugin.off("mouseout",this.onSceneMouseOut),this.control.off("floorchange",this.floorChangeHandler),this.floors.forEach((({labelGroups:t})=>{null==t||t.forEach((({id:t})=>{this.plugin.removeLabelGroup(t)}))})),this.plugin.removeModels([...this.buildings.keys(),...this.floors.keys()],t),this.map.removeLayer(r),this.groundCoveringSource.destroy(),this.undergroundFloors.clear(),this.control.destroy(),null===(e=this.popup)||void 0===e||e.destroy(),this.popup=void 0,this.state.activeModelId=void 0,this.state.buildingVisibility.clear(),this.buildings.clear(),this.floors.clear())}setMapOptions(t){if(!t)return;const e={easing:"easeInSine",duration:500};void 0!==t.center&&this.map.setCenter(t.center,e),void 0!==t.pitch&&this.map.setPitch(t.pitch,e),void 0!==t.rotation&&this.map.setRotation(t.rotation,e),void 0!==t.zoom&&this.map.setZoom(t.zoom,e)}switchOffGroundCovering(){const t=Object.assign({},this.groundCoveringSource.getAttributes());delete t.color,this.groundCoveringSource.setAttributes(t)}switchOnGroundCovering(){this.groundCoveringSource.setAttributes(Object.assign(Object.assign({},this.groundCoveringSource.getAttributes()),{color:this.options.groundCoveringColor}))}}const C=({description:t,title:e})=>`<div class="${I().popup}">\n        <h2>${e}</h2>\n        ${t?`<p>${t}</p>`:""}\n    </div>`;var O=function(t,e,o,n){return new(o||(o=Promise))((function(i,s){function r(t){try{d(n.next(t))}catch(t){s(t)}}function l(t){try{d(n.throw(t))}catch(t){s(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(r,l)}d((n=n.apply(t,e||[])).next())}))};const S={scale:1,rotation:0,offset:0,linkedIds:[],interactive:!1};class L extends t{constructor(t,e){super(),this.isDestroyed=!1,this.map=t,this.options=function(t,e){const o=Object.assign({},t);for(const t in e){const n=t;void 0===o[n]&&(o[n]=e[n])}return o}(null!=e?e:{},h),this.models=new Map,this.labelGroups=new u(this.map,this,this.options)}destroy(){var t;this.isDestroyed=!0,this.models.forEach((t=>{t.instance.destroy()})),this.models.clear(),this.labelGroups.destroy(),null===(t=this.realtyScene)||void 0===t||t.destroy()}setOptions(t){Object.keys(t).forEach((e=>{var o;"groundCoveringColor"===e&&(this.options.groundCoveringColor=t.groundCoveringColor,null===(o=this.realtyScene)||void 0===o||o.resetGroundCoveringColor())}))}addModel(t,e=!1){return O(this,void 0,void 0,(function*(){return this.addModels([t],e?[]:[t.modelId])}))}addModels(t,e){return O(this,void 0,void 0,(function*(){const o=t.filter((t=>!this.models.has(t.modelId)||(console.error(`A model with id ${t.modelId} already exists. The new model won't be added.`),!1))).map((t=>{var o,n,i,s,r,l,a,c,u,h,p;const g=(v=t.modelUrl,/^https?:\/\//i.test(v)?t.modelUrl:(f=this.options.modelsBaseUrl,m=t.modelUrl,0===f.length?m:"/"===f[f.length-1]?f+m:f+"/"+m));var f,m,v;const b=new mapgl.GltfModel(this.map,{coordinates:t.coordinates,modelSrc:g,scale:null!==(o=t.scale)&&void 0!==o?o:S.scale,rotation:[null!==(n=t.rotateX)&&void 0!==n?n:S.rotation,null!==(i=t.rotateY)&&void 0!==i?i:S.rotation,null!==(s=t.rotateZ)&&void 0!==s?s:S.rotation],offset:[null!==(r=t.offsetX)&&void 0!==r?r:S.offset,null!==(l=t.offsetY)&&void 0!==l?l:S.offset,null!==(a=t.offsetZ)&&void 0!==a?a:S.offset],linkedIds:null!==(c=t.linkedIds)&&void 0!==c?c:S.linkedIds,interactive:null!==(u=t.interactive)&&void 0!==u?u:S.interactive,userData:t.userData,hideOnInit:"waitAll"===this.options.modelsLoadStrategy||e&&!e.includes(t.modelId),hover:{color:this.options.hoverOptions.color},disableAnimation:!0,zIndex:this.options.zIndex,minZoom:null!==(h=t.minZoom)&&void 0!==h?h:this.options.minZoom,maxZoom:null!==(p=t.maxZoom)&&void 0!==p?p:this.options.maxZoom,nearCameraFade:this.options.modelsNearCameraFade,colorTextureUvIndex:this.options.modelsColorTextureUvIndex}),y={options:t,instance:b,isLoaded:!1};return this.models.set(t.modelId,y),new Promise((e=>{b.once("modelloaded",(()=>{y.isLoaded=!0,e(y)})),d.forEach((e=>{b.on(e,(o=>{this.emit(e,((t,e)=>({originalEvent:t.originalEvent,point:t.point,lngLat:t.lngLat,target:{type:"model",modelId:e.modelId,data:e}}))(o,t))}))}))}))}));return Promise.all(o).then((t=>{this.isDestroyed||"waitAll"===this.options.modelsLoadStrategy&&t.forEach((t=>{e&&!e.includes(t.options.modelId)||t.instance.show()}))}))}))}getModelStatus(t){const e=this.models.get(t);return e?e.isLoaded?b.Loaded:b.Loading:b.NoModel}removeModel(t,e){const o=this.models.get(t);o&&(o.instance.destroy(e),this.models.delete(t))}removeModels(t,e){t.forEach((t=>this.removeModel(t,e)))}showModel(t){var e;null===(e=this.models.get(t))||void 0===e||e.instance.show()}showModels(t){t.forEach((t=>this.showModel(t)))}hideModel(t){var e;null===(e=this.models.get(t))||void 0===e||e.instance.hide()}hideModels(t){t.forEach((t=>this.hideModel(t)))}addLabelGroup(t,e){this.labelGroups.add(t,e)}removeLabelGroup(t){this.labelGroups.remove(t)}addRealtyScene(t,e){var o;return O(this,void 0,void 0,(function*(){return null===(o=this.realtyScene)||void 0===o||o.destroy(),this.realtyScene=new _(this,this.map,this.options),this.realtyScene.init(t,e)}))}showRealtyScene(){var t;null===(t=this.realtyScene)||void 0===t||t.show()}hideRealtyScene(){var t;null===(t=this.realtyScene)||void 0===t||t.hide()}removeRealtyScene(t){var e;null===(e=this.realtyScene)||void 0===e||e.destroy(t),this.realtyScene=void 0}}"undefined"!=typeof window&&("mapgl"in window?mapgl.GltfPlugin=L:(window.__mapglPlugins||(window.__mapglPlugins={}),window.__mapglPlugins.GltfPlugin=L))})(),n})()));
